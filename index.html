<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <style>
      body {
        background-image: url('img/background.jpg');
        /* background-repeat: no-repeat; */
        background-position: center;
      }
    </style>
    <title>GPTExcel</title>
  </head>
  <body>
    <div class="container bg-danger pt-4 mt-5 ps-3 pe-3 pb-5 rounded-3">
      <div class="row d-flex">
        <div class="col-xl-12 justify-content-center">
          <button class="btn btn-primary">Formula</button>
          <button class="btn btn-primary">Script</button>
          <button class="btn btn-primary">SQL</button>
          <button class="btn btn-primary">Regex</button>
          <button class="btn btn-primary">Template</button>
        </div>
      </div>
      <div class="row d-flex form-floating justify-content-center mt-5">
        <div class="col-xl-6 col-md-6">
          <div class="bg-white p-3 rounded-3">
            <!-- <form> -->
            <h3 class="text-center">Formula Generator AI</h3>
            <p class="text-center">Generate Formula Excel, Google Sheets, and Airtable with AI.</p>
            <label for="use">I am using ...</label>
            <select name="opt" id="use" class="form-select mt-2">
              <option value="Excel">Excel</option>
              <option value="Google Sheets">Google Sheets</option>
              <option value="Airtable">Airtable</option>
            </select>
            <div class="version">
              <label for="ver" class="mt-3">I am use Excel ...</label>
              <select name="version" id="ver" class="form-select mt-2">
                <option value="Excel 365">Excel 365</option>
                <option value="Excel 2021">Excel 2021</option>
                <option value="Excel 2019">Excel 2019</option>
                <option value="Excel 2016">Excel 2016</option>
                <option value="Excel 2013">Excel 2013</option>
                <option value="Excel 2010">Excel 2010</option>
              </select>
            </div>
            <label for="email" class="mt-3 mb-2">I want the formula to be...</label>
            <div class="d-flex justify-content-evenly">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="type" id="radioGenerated" value="generator" checked />
                <label class="form-check-label" for="radioGenerated"> Generated </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="type" id="radioExplained" value="explainer" />
                <label class="form-check-label" for="radioExplained"> Explained </label>
              </div>
            </div>
            <p class="mt-4">Describe the formula you want to generate. try to be as detailed as possible</p>
            <textarea class="form-control mb-3" name="prompt" style="height: 150px"></textarea>
            <button type="submit" class="btn btn-outline-primary" onclick="sendQuery()">Send</button>
            <!-- </form> -->
          </div>
        </div>

        <div class="col-xl-6 col-md-6">
          <div class="bg-white p-3 rounded-3">
            <h3 class="text-center">Result</h3>
            <p>Result will show here.</p>
            <textarea name="result" class="form-control mb-3" style="height: 350px"></textarea>
            <button class="btn btn-outline-primary col-3" onclick="deleteForm()">Delete</button>
            <button class="btn btn-outline-primary col-3 ms-auto" onclick="copyToClipboard()">Copy</button>
          </div>
        </div>
      </div>
    </div>
    <footer class="mt-5 p-4 bg-primary">
      <p class="text-center text-white">Copyright &copy; 2023 - Muhammad Arifin Ilham</p>
    </footer>
    <script>
      document.querySelector('select[name="opt"]').addEventListener('change', function () {
        const toolGet = document.querySelector('select[name="opt"]').value;
        console.log(toolGet);
        if (toolGet == 'Excel') {
          document.getElementsByClassName('version')[0].style.display = 'block';
        } else {
          document.getElementsByClassName('version')[0].style.display = 'none';
        }
      });
      function sendQuery() {
        deleteForm();
        var promptValue = document.querySelector('textarea[name="prompt"]').value;
        // var type = document.querySelector('input[name="type"]:checked').value;
        // console.log(type);
        var tool = document.querySelector('select[name="opt"]').value;
        var act = document.querySelector('input[name="type"]:checked').value;
        console.log(`ACT: ${act}`);
        if (tool == 'Excel') {
          var version = document.querySelector('select[name="version"]').value;
        } else {
          var version = '';
        }
        console.log(tool);
        // var url = 'http://localhost:2004/api/?tools=formula&tool=' + tool + '&version=' + version + '&prompt=' + encodeURIComponent(promptValue) + '&act=' + act;

        var url = 'http://localhost:2004/api/';
        
        var params = new URLSearchParams();
        params.append('tools', 'formula');
        params.append('tool', tool);
        params.append('version', version);
        params.append('prompt', encodeURIComponent(promptValue));
        params.append('act', act);
        
        fetch(url, {
          method: 'POST',
          body: params,
        })
          .then((response) => response.text())
          .then((data) => {
            var resultTextarea = document.querySelector('textarea[name="result"]');
            var text = data;
            var speed = 10;
            var i = 0;
        
            function typeWriter() {
              if (i < text.length) {
                resultTextarea.value += text.charAt(i);
                i++;
                setTimeout(typeWriter, speed);
              } else {
                text = text.replace(/`excel /g, '');
                text += text.replace(/``/g, '');
              }
            }
        
            typeWriter();
          })
          .catch((error) => {
            console.error(error);
          });
      }
      function deleteForm() {
        var resultTextarea = document.querySelector('textarea[name="result"]');
        resultTextarea.value = '';
      }
      function copyToClipboard() {
        var resultTextarea = document.querySelector('textarea[name="result"]');
        resultTextarea.select();
        document.execCommand('copy');
        alert('Copied to clipboard');
        console.log(resultTextarea.value);
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  </body>
</html>
